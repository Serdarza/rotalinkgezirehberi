<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>RotaLink – Şehir Ara</title>
<meta name="theme-color" content="#f7faff" />
<style>
  :root{
    --bg:#f7faff;--card:#fff;--text:#0f172a;--muted:#475569;
    --b1:#0ea5e9;--b2:#22d3ee;--ok:#22c55e;--share:#a78bfa;--go:#fb923c;--bd:#e2e8f0
  }
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto}
  a{text-decoration:none;color:inherit}
  .container{max-width:1100px;margin:auto;padding:18px}
  header{display:flex;align-items:center;justify-content:space-between;padding:10px 0;border-bottom:1px solid var(--bd);background:#fff}
  .logo{display:flex;gap:10px;align-items:center;font-weight:800}
  .badge{width:30px;height:30px;border-radius:10px;display:grid;place-items:center;background:linear-gradient(135deg,var(--b1),var(--b2));color:#00131a}
  nav{display:flex;gap:14px;color:var(--muted)}
  .search-box{margin-top:14px}
  .search-box h2{margin:0 0 8px;font-size:18px}
  .search-box input{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #cbd5e1;background:#fff}
  .grid{margin-top:14px;display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
  .col{background:var(--card);border:1px solid var(--bd);border-radius:10px;padding:10px;display:flex;flex-direction:column;gap:8px;min-height:200px}
  .col h3{margin:0 0 6px;font-size:16px;border-bottom:1px solid var(--bd);padding-bottom:6px}
  .item{border:1px solid var(--bd);border-radius:8px;padding:8px;background:#fff;display:flex;align-items:center;gap:10px;justify-content:space-between}
  .item-title{font-weight:700;font-size:14px;flex:1;min-width:120px}
  .actions{display:flex;gap:6px;flex-wrap:wrap;justify-content:flex-end}
  .btn{display:inline-flex;align-items:center;justify-content:center;padding:6px 10px;border-radius:8px;border:0;font-weight:700;font-size:13px;color:#0b1320;background:#f1f5f9}
  .btn.call{background:linear-gradient(135deg,var(--b1),var(--b2));color:#00131a}
  .btn.share{background:linear-gradient(135deg,var(--share),#f472b6)}
  .btn.go{background:linear-gradient(135deg,var(--ok),var(--go))}
  .empty{color:var(--muted);font-size:13px}
  @media(max-width:980px){.grid{grid-template-columns:repeat(2,1fr)}}
  @media(max-width:560px){.grid{grid-template-columns:1fr}.item{flex-direction:column;align-items:flex-start}.actions{width:100%}}
</style>
</head>
<body>
<div class="container">
  <header>
    <div class="logo"><div class="badge">RL</div><span>RotaLink</span></div>
    <nav><span>Şehir Ara</span></nav>
  </header>

  <section class="search-box">
    <h2>Şehir Ara</h2>
    <input id="q" placeholder="örn. Düzce, Kayseri, Kocaeli" autocomplete="off" />
  </section>

  <section class="grid" id="grid">
    <div class="col" id="col-tesis"><h3>Tesis</h3><div class="empty">Şehir yazın.</div></div>
    <div class="col" id="col-gezi"><h3>Gezi</h3><div class="empty">Şehir yazın.</div></div>
    <div class="col" id="col-yemek"><h3>Yemek</h3><div class="empty">Şehir yazın.</div></div>
    <div class="col" id="col-sosyal"><h3>Sosyal</h3><div class="empty">Şehir yazın.</div></div>
  </section>
</div>

<script>
const S = { loaded:false, data:[], gezi:[], yemek:[], sosyal:[] };

async function loadAll(){
  if(S.loaded) return;
  const files = ['data.json','gezi.json','yemek.json','sosyal.json'];
  try{
    const [d,g,y,s] = await Promise.all(files.map(f => fetch(f,{cache:'no-store'}).then(r=>r.ok?r.json():[]).catch(()=>[])));
    S.data=d; S.gezi=g; S.yemek=y; S.sosyal=s; S.loaded=true;
  }catch{ S.data=S.gezi=S.yemek=S.sosyal=[]; S.loaded=true; }
}

const qEl = document.getElementById('q');
qEl.addEventListener('input', run);

function phoneHref(t){ const d=String(t||'').replace(/[^0-9+]/g,''); return d?`tel:${d}`:''; }
function mapsHref(il, isim, lat, lng){
  if(lat && lng) return `https://www.google.com/maps/search/?api=1&query=${lat},${lng}`;
  return `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent((il||'')+' '+(isim||''))}`;
}
function searchHref(isim, il){ return `https://www.google.com/search?q=${encodeURIComponent((isim||'')+' '+(il||''))}`; }

function renderList(el, items, kind){
  el.innerHTML = '';
  if(!items.length){ el.innerHTML = '<div class="empty">Sonuç yok.</div>'; return; }
  items.forEach(it=>{
    const row = document.createElement('div');
    row.className='item';
    const title = document.createElement('div');
    title.className='item-title';
    title.textContent = it.isim || 'İsimsiz';
    row.appendChild(title);

    const act = document.createElement('div'); act.className='actions';

    if(kind==='tesis'){
      const tel = phoneHref(it.telefon);
      const maps = mapsHref(it.il, it.isim, it.latitude, it.longitude);
      act.innerHTML =
        (tel ? `<a class="btn call" href="${tel}">Ara</a>` : `<button class="btn" disabled>Telefon yok</button>`) +
        `<button class="btn share" onclick='navigator.share?navigator.share({title:"${(it.isim||'Konum').replace(/"/g,'&quot;')}",url:"${maps}"}) : navigator.clipboard.writeText("${maps}")'>Paylaş</button>`+
        `<a class="btn go" href="${maps}" target="_blank" rel="noopener">Git</a>`;
    }else{
      const google = searchHref(it.isim, it.il);
      act.innerHTML =
        `<a class="btn go" href="${google}" target="_blank" rel="noopener">İncele</a>`;
    }

    row.appendChild(act);
    el.appendChild(row);
  });
}

async function run(){
  const q = qEl.value.trim().toLowerCase();
  if(!q){
    ['col-tesis','col-gezi','col-yemek','col-sosyal'].forEach(id=>{
      const c=document.getElementById(id);
      c.querySelectorAll('.item,.empty').forEach(n=>n.remove());
      const a=document.createElement('div'); a.className='empty'; a.textContent='Şehir yazın.'; c.appendChild(a);
    });
    return;
  }
  await loadAll();
  const f = x => (x.il||'').toLowerCase().includes(q);

  const tEl = document.getElementById('col-tesis');
  const gEl = document.getElementById('col-gezi');
  const yEl = document.getElementById('col-yemek');
  const sEl = document.getElementById('col-sosyal');

  renderList(tEl, S.data.filter(f), 'tesis');
  renderList(gEl, S.gezi.filter(f), 'gezi');
  renderList(yEl, S.yemek.filter(f), 'yemek');
  renderList(sEl, S.sosyal.filter(f), 'sosyal');
}

</script>
</body>
</html>
